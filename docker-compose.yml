# PDFexport - Docker Compose
version: '3.8'

services:
  pdfexport:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pdfexport
    restart: unless-stopped

    # Variables de entorno
    environment:
      # Configuracion del servidor
      - HOST=0.0.0.0
      - PORT=5000
      - DEBUG=False

      # Configuracion para el frontend (URLs publicas)
      # Cambiar segun el dominio/IP donde se accede
      - BACKEND_PROTOCOL=http
      - BACKEND_HOST=localhost
      - BACKEND_PORT=5000

      # Timeouts del frontend
      - TIMEOUT=30000
      - RETRY_ATTEMPTS=3

    # Puertos expuestos
    ports:
      - "5000:5000"

    # Volumenes para persistencia
    volumes:
      # Base de datos SQLite
      - pdfexport_data:/app/data
      # Archivos subidos (opcional, se limpian cada 4h)
      - pdfexport_uploads:/app/uploads
      # Archivos de salida (opcional)
      - pdfexport_outputs:/app/outputs

    # Limites de recursos
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M

    # Healthcheck
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/api/v1/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Volumenes nombrados
volumes:
  pdfexport_data:
    name: pdfexport_data
  pdfexport_uploads:
    name: pdfexport_uploads
  pdfexport_outputs:
    name: pdfexport_outputs
